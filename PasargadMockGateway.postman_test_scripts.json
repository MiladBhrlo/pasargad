{
    "info": {
        "name": "Pasargad Mock Gateway Tests",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "Test Scenarios",
            "item": [
                {
                    "name": "Scenario 1: Successful Payment Flow",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Step 1: Get Token",
                                    "pm.sendRequest({",
                                    "    url: pm.variables.get('baseUrl') + '/token/getToken',",
                                    "    method: 'POST',",
                                    "    header: {",
                                    "        'Content-Type': 'application/json'",
                                    "    },",
                                    "    body: {",
                                    "        mode: 'raw',",
                                    "        raw: JSON.stringify({",
                                    "            Username: 'ipgTestUser',",
                                    "            Password: '123456'",
                                    "        })",
                                    "    }",
                                    "}, function (err, res) {",
                                    "    if (err) {",
                                    "        console.error(err);",
                                    "    } else {",
                                    "        var jsonData = res.json();",
                                    "        pm.variables.set('token', jsonData.Token);",
                                    "        ",
                                    "        // Step 2: Purchase Request",
                                    "        pm.sendRequest({",
                                    "            url: pm.variables.get('baseUrl') + '/api/payment/purchase',",
                                    "            method: 'POST',",
                                    "            header: {",
                                    "                'Content-Type': 'application/json',",
                                    "                'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "            },",
                                    "            body: {",
                                    "                mode: 'raw',",
                                    "                raw: JSON.stringify({",
                                    "                    ServiceCode: '8',",
                                    "                    ServiceType: 'PURCHASE',",
                                    "                    PaymentCode: '123456',",
                                    "                    InvoiceNumber: 'INV-001',",
                                    "                    Amount: 1000,",
                                    "                    RedirectUrl: 'https://your-site.com/callback'",
                                    "                })",
                                    "            }",
                                    "        }, function (err, res) {",
                                    "            if (err) {",
                                    "                console.error(err);",
                                    "            } else {",
                                    "                var jsonData = res.json();",
                                    "                pm.variables.set('paymentUrl', jsonData.Data.Url);",
                                    "                ",
                                    "                // Step 3: Confirm Transaction",
                                    "                pm.sendRequest({",
                                    "                    url: pm.variables.get('baseUrl') + '/api/payment/confirm-transactions',",
                                    "                    method: 'POST',",
                                    "                    header: {",
                                    "                        'Content-Type': 'application/json',",
                                    "                        'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "                    },",
                                    "                    body: {",
                                    "                        mode: 'raw',",
                                    "                        raw: JSON.stringify({",
                                    "                            Invoice: 'INV-001',",
                                    "                            TerminalCode: '123456'",
                                    "                        })",
                                    "                    }",
                                    "                }, function (err, res) {",
                                    "                    if (err) {",
                                    "                        console.error(err);",
                                    "                    } else {",
                                    "                        pm.test('Transaction confirmed successfully', function () {",
                                    "                            pm.expect(res.json().ResultCode).to.equal(0);",
                                    "                        });",
                                    "                    }",
                                    "                });",
                                    "            }",
                                    "        });",
                                    "    }",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ]
                },
                {
                    "name": "Scenario 2: Failed Payment Flow",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Step 1: Get Token",
                                    "pm.sendRequest({",
                                    "    url: pm.variables.get('baseUrl') + '/token/getToken',",
                                    "    method: 'POST',",
                                    "    header: {",
                                    "        'Content-Type': 'application/json'",
                                    "    },",
                                    "    body: {",
                                    "        mode: 'raw',",
                                    "        raw: JSON.stringify({",
                                    "            Username: 'ipgTestUser',",
                                    "            Password: '123456'",
                                    "        })",
                                    "    }",
                                    "}, function (err, res) {",
                                    "    if (err) {",
                                    "        console.error(err);",
                                    "    } else {",
                                    "        var jsonData = res.json();",
                                    "        pm.variables.set('token', jsonData.Token);",
                                    "        ",
                                    "        // Step 2: Purchase Request",
                                    "        pm.sendRequest({",
                                    "            url: pm.variables.get('baseUrl') + '/api/payment/purchase',",
                                    "            method: 'POST',",
                                    "            header: {",
                                    "                'Content-Type': 'application/json',",
                                    "                'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "            },",
                                    "            body: {",
                                    "                mode: 'raw',",
                                    "                raw: JSON.stringify({",
                                    "                    ServiceCode: '8',",
                                    "                    ServiceType: 'PURCHASE',",
                                    "                    PaymentCode: '123456',",
                                    "                    InvoiceNumber: 'INV-002',",
                                    "                    Amount: 1000,",
                                    "                    RedirectUrl: 'https://your-site.com/callback'",
                                    "                })",
                                    "            }",
                                    "        }, function (err, res) {",
                                    "            if (err) {",
                                    "                console.error(err);",
                                    "            } else {",
                                    "                var jsonData = res.json();",
                                    "                pm.variables.set('paymentUrl', jsonData.Data.Url);",
                                    "                ",
                                    "                // Step 3: Payment Inquiry",
                                    "                pm.sendRequest({",
                                    "                    url: pm.variables.get('baseUrl') + '/api/payment/payment-inquiry',",
                                    "                    method: 'POST',",
                                    "                    header: {",
                                    "                        'Content-Type': 'application/json',",
                                    "                        'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "                    },",
                                    "                    body: {",
                                    "                        mode: 'raw',",
                                    "                        raw: JSON.stringify({",
                                    "                            InvoiceId: 'INV-002',",
                                    "                            TerminalCode: '123456'",
                                    "                        })",
                                    "                    }",
                                    "                }, function (err, res) {",
                                    "                    if (err) {",
                                    "                        console.error(err);",
                                    "                    } else {",
                                    "                        pm.test('Payment inquiry completed', function () {",
                                    "                            pm.expect(res.json().ResultCode).to.equal(0);",
                                    "                        });",
                                    "                    }",
                                    "                });",
                                    "            }",
                                    "        });",
                                    "    }",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ]
                },
                {
                    "name": "Scenario 3: Transaction Reversal Flow",
                    "event": [
                        {
                            "listen": "test",
                            "script": {
                                "exec": [
                                    "// Step 1: Get Token",
                                    "pm.sendRequest({",
                                    "    url: pm.variables.get('baseUrl') + '/token/getToken',",
                                    "    method: 'POST',",
                                    "    header: {",
                                    "        'Content-Type': 'application/json'",
                                    "    },",
                                    "    body: {",
                                    "        mode: 'raw',",
                                    "        raw: JSON.stringify({",
                                    "            Username: 'ipgTestUser',",
                                    "            Password: '123456'",
                                    "        })",
                                    "    }",
                                    "}, function (err, res) {",
                                    "    if (err) {",
                                    "        console.error(err);",
                                    "    } else {",
                                    "        var jsonData = res.json();",
                                    "        pm.variables.set('token', jsonData.Token);",
                                    "        ",
                                    "        // Step 2: Purchase Request",
                                    "        pm.sendRequest({",
                                    "            url: pm.variables.get('baseUrl') + '/api/payment/purchase',",
                                    "            method: 'POST',",
                                    "            header: {",
                                    "                'Content-Type': 'application/json',",
                                    "                'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "            },",
                                    "            body: {",
                                    "                mode: 'raw',",
                                    "                raw: JSON.stringify({",
                                    "                    ServiceCode: '8',",
                                    "                    ServiceType: 'PURCHASE',",
                                    "                    PaymentCode: '123456',",
                                    "                    InvoiceNumber: 'INV-003',",
                                    "                    Amount: 1000,",
                                    "                    RedirectUrl: 'https://your-site.com/callback'",
                                    "                })",
                                    "            }",
                                    "        }, function (err, res) {",
                                    "            if (err) {",
                                    "                console.error(err);",
                                    "            } else {",
                                    "                var jsonData = res.json();",
                                    "                pm.variables.set('paymentUrl', jsonData.Data.Url);",
                                    "                ",
                                    "                // Step 3: Confirm Transaction",
                                    "                pm.sendRequest({",
                                    "                    url: pm.variables.get('baseUrl') + '/api/payment/confirm-transactions',",
                                    "                    method: 'POST',",
                                    "                    header: {",
                                    "                        'Content-Type': 'application/json',",
                                    "                        'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "                    },",
                                    "                    body: {",
                                    "                        mode: 'raw',",
                                    "                        raw: JSON.stringify({",
                                    "                            Invoice: 'INV-003',",
                                    "                            TerminalCode: '123456'",
                                    "                        })",
                                    "                    }",
                                    "                }, function (err, res) {",
                                    "                    if (err) {",
                                    "                        console.error(err);",
                                    "                    } else {",
                                    "                        // Step 4: Reverse Transaction",
                                    "                        pm.sendRequest({",
                                    "                            url: pm.variables.get('baseUrl') + '/api/payment/reverse-transactions',",
                                    "                            method: 'POST',",
                                    "                            header: {",
                                    "                                'Content-Type': 'application/json',",
                                    "                                'Authorization': 'Bearer ' + pm.variables.get('token')",
                                    "                            },",
                                    "                            body: {",
                                    "                                mode: 'raw',",
                                    "                                raw: JSON.stringify({",
                                    "                                    Invoice: 'INV-003',",
                                    "                                    TerminalCode: '123456'",
                                    "                                })",
                                    "                            }",
                                    "                        }, function (err, res) {",
                                    "                            if (err) {",
                                    "                                console.error(err);",
                                    "                            } else {",
                                    "                                pm.test('Transaction reversed successfully', function () {",
                                    "                                    pm.expect(res.json().ResultCode).to.equal(0);",
                                    "                                });",
                                    "                            }",
                                    "                        });",
                                    "                    }",
                                    "                });",
                                    "            }",
                                    "        });",
                                    "    }",
                                    "});"
                                ],
                                "type": "text/javascript"
                            }
                        }
                    ]
                }
            ]
        }
    ],
    "variable": [
        {
            "key": "baseUrl",
            "value": "http://localhost:4000",
            "type": "string"
        }
    ]
} 