# مستندات درگاه پرداخت پاسارگاد

## مقدمه
این مستندات شامل توضیحات کامل API های درگاه پرداخت پاسارگاد می‌باشد. این API ها برای انجام تراکنش‌های مالی و مدیریت پرداخت‌ها استفاده می‌شوند.

## سرویس‌های اصلی

### 1. دریافت توکن (GetToken)
- **آدرس**: `/token/getToken`
- **متد**: POST
- **توضیحات**: برای دریافت توکن دسترسی به API های درگاه پرداخت
- **پارامترهای ورودی**:
  - `Username`: نام کاربری
  - `Password`: رمز عبور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Token`: توکن دسترسی
  - `Username`: نام کاربری
  - `FirstName`: نام
  - `LastName`: نام خانوادگی
  - `UserId`: شناسه کاربری
  - `Roles`: نقش‌های کاربر

### 2. خرید (Purchase)
- **آدرس**: `/api/payment/purchase`
- **متد**: POST
- **توضیحات**: برای ایجاد درخواست خرید
- **پارامترهای ورودی**:
  - `ServiceCode`: کد سرویس (مثلاً "8")
  - `ServiceType`: نوع سرویس (مثلاً "PURCHASE")
  - `PaymentCode`: کد پرداخت (برای خرید شناسه دار)
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`:
    - `UrlId`: شناسه یکتای URL
    - `Url`: آدرس درگاه پرداخت

### 3. تایید تراکنش (ConfirmTransaction)
- **آدرس**: `/api/payment/confirm-transactions`
- **متد**: POST
- **توضیحات**: برای تایید تراکنش انجام شده
- **پارامترهای ورودی**:
  - `Invoice`: شماره فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`:
    - `Invoice`: شماره فاکتور
    - `ReferenceNumber`: شماره مرجع
    - `TrackId`: شناسه پیگیری
    - `MaskedCardNumber`: شماره کارت ماسک شده
    - `HashedCardNumber`: شماره کارت هش شده
    - `RequestDate`: تاریخ درخواست
    - `Amount`: مبلغ تراکنش

### 4. تاییدیه تراکنش (VerifyTransaction)
- **آدرس**: `/api/payment/verify-transactions`
- **متد**: POST
- **توضیحات**: برای دریافت تاییدیه تراکنش
- **پارامترهای ورودی**:
  - `Invoice`: شماره فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`: "تراکنش موفق است"

### 5. تاییدیه پرداخت با اطلاعات تکمیلی (VerifyPayment)
- **آدرس**: `/api/payment/verify-payment`
- **متد**: POST
- **توضیحات**: برای دریافت تاییدیه پرداخت با جزئیات بیشتر
- **پارامترهای ورودی**:
  - `Invoice`: شماره فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`: شامل اطلاعات کامل تراکنش

### 6. برگشت تراکنش (ReverseTransaction)
- **آدرس**: `/api/payment/reverse-transactions`
- **متد**: POST
- **توضیحات**: برای برگشت تراکنش
- **پارامترهای ورودی**:
  - `Invoice`: شماره فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"

### 7. استعلام وضعیت تراکنش (PaymentInquiry)
- **آدرس**: `/api/payment/payment-inquiry`
- **متد**: POST
- **توضیحات**: برای استعلام وضعیت تراکنش
- **پارامترهای ورودی**:
  - `InvoiceId`: شناسه فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`: شامل اطلاعات کامل تراکنش

### 8. استعلام وضعیت تراکنش با شماره کارت هش شده (PaymentInquiryV2)
- **آدرس**: `/api/payment/payment-inquiryv2`
- **متد**: POST
- **توضیحات**: برای استعلام وضعیت تراکنش با استفاده از شماره کارت هش شده
- **پارامترهای ورودی**:
  - `InvoiceId`: شناسه فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"
  - `Data`: شامل اطلاعات کامل تراکنش

### 9. برگشت از خرید (RefundTransaction)
- **آدرس**: `/api/payment/refund-transactions`
- **متد**: POST
- **توضیحات**: برای برگشت مبلغ خرید
- **پارامترهای ورودی**:
  - `Type`: نوع برگشت (RefundOnline یا RefundOffline)
  - `Invoice`: شماره فاکتور
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"

### 10. تایید رمز (ConfirmPin)
- **آدرس**: `/api/payment/inquiry-confirm-pin`
- **متد**: POST
- **توضیحات**: برای تایید رمز دوم کارت
- **پارامترهای ورودی**:
  - `ExpireMonth`: ماه انقضای کارت
  - `ExpireYear`: سال انقضای کارت
  - `Cvv2`: کد امنیتی کارت
  - `Pin2`: رمز دوم کارت
- **پاسخ موفق**:
  - `ResultCode`: 0
  - `ResultMsg`: "تراکنش موفق است"

## کدهای خطا
کدهای خطای اصلی درگاه پرداخت پاسارگاد به شرح زیر است:

- `0`: تراکنش موفق است
- `1`: ناموفق
- `2`: نامشخص
- `401`: مجاز به استفاده از سرویس نیستید
- `500`: خطا داخلی سرور
- `13000`: ورودی نامعتبر است
- `13001`: آدرس نامعتبر است
- `13002`: توکن نامعتبر است
- `13003`: کد رهگیری یکتا نیست
- `13004`: توکن خالی است
- `13005`: عدم امکان دسترسی موقت به سرور
- `13007`: کپچا منقضی شده است
- `13008`: کپچا اشتباه است
- `13009`: توکن یافت نشد
- `13010`: شماره موبایل نامعتبر است
- `13011`: کد محصول نامعتبر است
- `13012`: شناسه قبض نامعتبر است
- `13013`: شناسه پرداخت نامعتبر است
- `13015`: برای فراخوانی مجدد 2 دقیقه صبر کنید
- `13016`: تراکنش یافت نشد
- `13017`: طول ورودی نامعتبر است
- `13018`: یافت نشد
- `13019`: کد رهگیری برای کاربر لاگین شده در سیستم وجود ندارد
- `13020`: خطا هنگام چک کردن کد شرکت
- `13021`: پرداخت از پیش لغو شده است
- `13022`: تراکنش پرداخت نشده است
- `13025`: تراکنش ناموفق است
- `13026`: شماره کارت نامعتبر است
- `13027`: شماره موبایل برای شماره کارت وارد شده نیست
- `13028`: آدرس کالبک نامعتبر است
- `13029`: تراکنش موفق و تایید شده است
- `13030`: تراکنش تاییده شده و ناموفق است
- `13031`: تراکنش منتظر تایید است
- `13032`: کارت منقضی شده است
- `13033`: تراکنش و بازگشت تراکنش با موفقیت انجام شده است
- `13035`: تراکنش مجاز به انجام عملیات بازگشت نمی باشد
- `13045`: دارنده کارت تراکنش را لغو کرد
- `13046`: تراکنش تسویه شده است
- `13047`: پذیرنده کارت نامعتبر است
- `13049`: تراکنش کامل نشده است
- `13054`: تراکنش نامعتبر است
- `13055`: مبلغ تراکنش نامعتبر است
- `13056`: صادرکننده کارت نامعتبر است
- `13057`: تاریخ کارت منقضی شده است
- `13058`: کارت موقتاً مسدود شده است
- `13059`: حساب تعریف نشده است
- `13060`: نوع تراکنش نامعتبر است
- `13061`: شناسه انتقال نامعتبر است
- `13062`: تراکنش تکراری
- `13063`: مبلغ کافی نیست
- `13064`: پین اشتباه است
- `13065`: کارت نامعتبر است
- `13066`: سرویس روی کارت مجاز نیست
- `13067`: کارت برای ترمینال مجاز نیست
- `13068`: مبلغ تراکنش بیش از حد مجاز است
- `13069`: کارت محدود است
- `13070`: خطای امنیتی
- `13071`: مبلغ تراکنش با قیمت نهایی مطابقت ندارد
- `13072`: درخواست تراکنش بیش از حد مجاز است
- `13073`: حساب غیر فعال است
- `13074`: کارت توسط ترمینال مسدود شد
- `13075`: زمان تأییدیه منقضی شده است
- `13076`: زمان اصلاحیه منقضی شده است
- `13077`: تراکنش اصلی نامعتبر است
- `13078`: مبلغ اشتباه است
- `13079`: روز کاری نامعتبر است
- `13080`: کارت غیر فعال است
- `13081`: حساب کارت نامعتبر است
- `13082`: تراکنش ناموفق است
- `13083`: داده های رمزگذاری شده نامعتبر است
- `13084`: سوئیچ یا شاپرک خاموش است
- `13085`: میزبان بانک مقصد پایین است
- `13086`: اطلاعات تاییدیه نامعتبر است
- `13087`: سوئیچ یا شاپرک در حال خاموش شدن است
- `13088`: کلید رمزگذاری شده نامعتبر است
- `13089`: انجام تراکنش با واسط غیرتماسی مردود شده است
- `13090`: پایان روز کاری
- `13091`: سوئیچ غیر فعال است
- `13092`: صادرکننده کارت نامعتبر
- `13093`: تراکنش موفقیت آمیز نیست
- `13094`: تراکنش تکراری است
- `13095`: پین قدیمی اشتباه است
- `13096`: خطای داخلی سوئیچ
- `13097`: در حال انجام فرآیند تغییر کلید
- `13098`: پین استاتیک فراتر از محدودیت
- `13099`: پایانه فروش نامعتبر است

## نکات مهم
1. تمام درخواست‌ها باید با توکن معتبر ارسال شوند (به جز درخواست دریافت توکن)
2. برای هر تراکنش باید یک شماره فاکتور یکتا استفاده شود
3. مبلغ تراکنش باید به ریال باشد
4. در صورت بروز خطا، پیام خطا به زبان فارسی و انگلیسی در پاسخ ارسال می‌شود
5. برای امنیت بیشتر، تمام ارتباطات باید از طریق HTTPS انجام شود
6. در صورت نیاز به برگشت تراکنش، باید از سرویس برگشت تراکنش استفاده شود
7. برای استعلام وضعیت تراکنش می‌توان از سرویس‌های استعلام استفاده کرد
8. در صورت نیاز به تایید رمز دوم کارت، باید از سرویس تایید رمز استفاده شود 